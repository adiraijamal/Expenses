{% extends 'base.html' %}

{% block content %}

<body>
<select id="report-monthly-month" name="month">
  {% for month, month_name in MONTH_CHOICES %}
    <option value="{{ month }}">{{ month_name }}</option>
  {% endfor %}
</select>
    <button id="load-btn">Load</button>
    <br><br>
    <h3 id="total"></h3>
    <table border="2" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Date</th>
                <th>Details</th>
                <th>Category</th>
                <th>Sub Details</th>
                <th>Pay Mode</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody id="table-body">
          {% for transaction in transactions %}
          <tr>
              <td>{{ transaction.trans_id }}</td>
              <td>{{ transaction.trans_date }}</td>
              <td>{{ transaction.details }}</td>
              <td>{{ transaction.category }}</td>
              <td>{{ transaction.sub_details }}</td>
              <td>{{ transaction.pay_mode }}</td>
              <td>{{ transaction.trans_amount }}</td>
          </tr>
          {% endfor %}
          <tr>
              <td colspan="6">Total:</td>
              <td>{{ total }}</td>
          </tr>
          
        </tbody>
    </table>
</body>

<script>
    document.getElementById('load-btn').addEventListener('click', function() {
        var month = document.getElementById('month-select').value;
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/report_monthwise_data/' + month);
        xhr.onload = function() {
            var data = JSON.parse(xhr.responseText);
            var tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';

            for (var i = 0; i < data.length; i++) {
                var row = document.createElement('tr');
                var trans_id_cell = document.createElement('td');
                trans_id_cell.innerHTML = data[i].trans_id;
                row.appendChild(trans_id_cell);

                var trans_date_cell = document.createElement('td');
                trans_date_cell.innerHTML = data[i].trans_date;
                row.appendChild(trans_date_cell);

                var details_cell = document.createElement('td');
                details_cell.innerHTML = data[i].details;
                row.appendChild(details_cell);

                var category_cell = document.createElement('td');
                category_cell.innerHTML = data[i].category;
                row.appendChild(category_cell);

                var sub_details_cell = document.createElement('td');
                sub_details_cell.innerHTML = data[i].sub_details;
                row.appendChild(sub_details_cell);

                var pay_mode_cell = document.createElement('td');
                pay_mode_cell.innerHTML = data[i].pay_mode;
                row.appendChild(pay_mode_cell);

                var amount_cell = document.createElement('td');
                amount_cell.innerHTML = data[i].trans_amount;
                row.appendChild(amount_cell);

                tableBody.appendChild(row);
            }
            document.getElementById('total').innerHTML = 'Total: ' + data.total;
        };
        xhr.send();
    });
</script>

{% endblock %}
