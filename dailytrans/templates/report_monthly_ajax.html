{% extends 'base.html' %}

{% block content %}
    <h2>Monthly Report (Ajax)</h2>
    <label for="month-select">Select Month:</label>
    <select id="month-select">
        <option value="1">Jan</option>
        <option value="2">Feb</option>
        <option value="3">Mar</option>
        <option value="4">Apr</option>
        <option value="5">May</option>
        <option value="6">Jun</option>
        <option value="7">Jul</option>
        <option value="8">Aug</option>
        <option value="9">Sep</option>
        <option value="10">Oct</option>
        <option value="11">Nov</option>
        <option value="12">Dec</option>
    </select>
    <button id="report-monthly-ajax-btn">Get Report</button>

    <div id="report-monthly-ajax-container"></div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const monthSelect = document.querySelector('#month-select');
        const reportContainer = document.querySelector('#report-monthly-ajax-container');
        const getReportBtn = document.querySelector('#report-monthly-ajax-btn');

        monthSelect.addEventListener('change', function() {
          const selectedMonth = monthSelect.value;
          fetch(`/report_monthwise_ajax/${selectedMonth}`)
            .then(response => response.json())
            .then(data => {
              const transactions = data.transactions;
              const total = data.total;
              let tableHtml = '<table>';
              tableHtml += '<thead><tr><th>Transaction ID</th><th>Date</th><th>Description</th><th>Amount</th></tr></thead>';
              tableHtml += '<tbody>';
              for (let i = 0; i < transactions.length; i++) {
                tableHtml += `<tr><td>${transactions[i].trans_date}</td><td>${transactions[i].trans_type}</td><td>${transactions[i].trans_amount}</td></tr>`;
              }
              tableHtml += '</tbody>';
              tableHtml += `<tfoot><tr><td colspan="3">Total</td><td>${total}</td></tr></tfoot>`;
              tableHtml += '</table>';
              reportContainer.innerHTML = tableHtml;
            })
            .catch(error => {
              console.error('Error:', error);
            });
        });

        getReportBtn.addEventListener('click', function() {
          const selectedMonth = monthSelect.value;
          fetch(`/report_monthwise_ajax/${selectedMonth}`)
            .then(response => response.json())
            .then(data => {
              const transactions = data.transactions;
              const total = data.total;
              let tableHtml = '<table>';
              tableHtml += '<thead><tr><th>Transaction ID</th><th>Date</th><th>Description</th><th>Amount</th></tr></thead>';
              tableHtml += '<tbody>';
              for (let i = 0; i < transactions.length; i++) {
                tableHtml += `<tr><td>${transactions[i].id}</td><td>${transactions[i].trans_date}</td><td>${transactions[i].trans_desc}</td><td>${transactions[i].trans_amount}</td></tr>`;
              }
              tableHtml += '</tbody>';
              tableHtml += `<tfoot><tr><td colspan="3">Total</td><td>${total}</td></tr></tfoot>`;
              tableHtml += '</table>';
              reportContainer.innerHTML = tableHtml;
            })
            .catch(error => {
              console.error('Error:', error);
            });
        });
      });
</script>

{% endblock %}
