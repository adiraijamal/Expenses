{% extends 'base.html' %}

{% block content %}

<div class="container">
  <h1>Monthly Transaction Report</h1>
  <div class="row">
    <div class="col-md-12">
      <form method="GET" action="{% url 'dailytrans:report_monthly_ajax'  %}">
        <div class="form-group row">
          <label class="col-sm-2 col-form-label">Month:</label>
          <div class="col-sm-3">
            <select class="form-control" name="month" id="month">
              <option value="">Select Month</option>
              <option value="1">January</option>
              <option value="2">February</option>
              <option value="3">March</option>
              <option value="4">April</option>
              <option value="5">May</option>
              <option value="6">June</option>
              <option value="7">July</option>
              <option value="8">August</option>
              <option value="9">September</option>
              <option value="10">October</option>
              <option value="11">November</option>
              <option value="12">December</option>
            </select>
          </div>
          <div class="col-sm-2">
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </div>
      </form>
    </div>
  </div>

    <div class="row">
      <div class="col-md-12">
        <table class="table table-striped">
          <thead>
            <tr>
              <th scope="col"> Date</th>
              <th scope="col"> Type</th>
              <th scope="col"> Main Category</th>
              <th scope="col"> Sub Category</th>
              <th scope="col"> Mode</th>
              <th scope="col"> Amount</th>
            </tr>
          </thead>
          <tbody id="transaction-data">
          </tbody>
        </table>
      </div>
    </div>

  </div>

  <script>
    $(document).ready(function () {
      $('#month').on('change', function () {
        var month = $(this).val();
        if (month) {
          $.ajax({
            url: "{% url 'dailytrans:report_monthly_ajax' month=selected_month %}".replace('selected_month', month),
            dataType: 'json',
            success: function (response) {
              $('#transaction-data').empty();
              if (response.length === 0) {
                $('#transaction-data').append('<tr><td colspan="7">No Transactions Found</td></tr>');
              } else {
                $.each(response, function (index, transaction) {
                  $('#transaction-data').append('<tr><td>'  + transaction.trans_date + '</td><td>' + transaction.trans_type + '</td><td>' + transaction.trans_main_category + '</td><td>' + transaction.trans_sub_category + '</td><td>' + transaction.trans_mode + '</td><td>' + transaction.trans_amount + '</td></tr>');
                });
              }
            },
            error: function (xhr, status, error) {
              console.error(error);
            }
          });
        }
      });
    });
  </script>


{% endblock %}
